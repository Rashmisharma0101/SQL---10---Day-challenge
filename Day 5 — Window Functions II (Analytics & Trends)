Concept focus: LAG, LEAD, moving averages, growth %
Practice:

1. Month-over-month revenue growth %.
1. with cte1 as (select orders.order_date, month(orders.order_date) as mn, sum(order_items.quantity * products.price) as revenue
from orders join order_items
on orders.order_id = order_items.order_id
join products.product_id = order_items.product_id
group by mn
order by mn),
cte2 as (select cte1.mn, cte1.order_date, cte1.revenue, lag() over (partition by mn order by cte1.revenue) as prev_revenue from cte1)
select cte2.mn, cte2.order_date, coalesce(100.0*((cte2.revenue - cte2.prev_revenue)/cte2.prev_revenue), 'first_month') as growth_percentage
from cte2

2. 7-day moving average of daily sales.
2. 

3. Find customers whose spend increased vs previous month.
3. with cte1 as (select orders.customer_id, month(orders.order_date) as mn, sum(orders.amount) as total
from orders
group by orders.customer_id, mn),
cte2 as (select cte1.customer_id, cte1.total, lag(cte1.total) over (partition by cte1.customer_id order by cte1.mn) as prev_revenue from cte1)
select cte2.customer_id, coalesce((cte2.total - cte2.prev_revenue), 0) as change from cte2
group by cte2.customer_id
having cte2.total > cte2.prev_revenue

4. Time difference (in days) between first and second purchase.
4. with cte1 as (select customer_id, row_number() over(partition by customer_id order by order_date) as rn from orders)
select first.customer_id, datediff(first.order_date, second.order_date) as timediff from
cte1 first join cte1 second
on first.customer_id = second.customer_id and first.rn =  1 and second.rn = 2
group by first.customer_id
order by first_timediff


5. For each category, show productâ€™s % contribution to total category revenue.
5. 
ğŸ’¡ Interview-ready topic: â€œHow do you calculate growth rates in SQL?â€
